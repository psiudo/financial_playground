<!-- back/docs/포트폴리오 시뮬레이션.md -->
## ✅ 포트폴리오 시뮬레이션 (주식 + 금융상품 통합 가상 투자)

**[목표]**  
사용자는 가상의 자산으로 주식과 금융상품 모두에 투자하고, 거래 내역과 수익률을 통합된 포트폴리오에서 확인할 수 있어야 한다.

---

### 시나리오

#### 1. 초기 상태

1. 사용자는 로그인한 상태에서 '가상 투자' 또는 '대시보드/포트폴리오' 메뉴에 접속한다.  
2. 시스템은 다음 정보를 불러온다:  
   - 초기 자산 (1,000만 원)  
   - 기존 거래 기록 (주식 거래 + 금융상품 가입)  
   - 보유 종목 및 금융상품 내역, 수익률 포함  

#### 2. 주식 매수 흐름

3. 사용자는 '매수하기' 페이지에서 주식 탭을 선택한다.  
4. 시스템은 미리 지정된 종목 리스트(예: 삼성전자, SK하이닉스 등)를 표시한다.  
5. 사용자는 종목 선택 → 수량 입력 → 현재가 확인 후 '매수 실행' 클릭  
6. 시스템은 수량 × 가격 계산 후 자산 차감 및 거래 기록 저장  
7. 거래 기록은 `PortfolioEntry`에 종목, 수량, 매수단가, 일시 등으로 기록됨  

#### 3. 주식 매도 흐름

8. 사용자는 보유 종목 리스트에서 '매도' 버튼을 클릭한다.  
9. 매도 페이지에는 수량, 평균 매수단가, 현재가, 수익률이 표시된다.  
10. 수량 입력 후 '매도 실행' 클릭 → 자산 추가 및 수익률 반영  
11. 매도 일시와 실현 수익 계산도 기록됨  

#### 4. 금융상품 가입 흐름

12. 사용자는 '금융상품' 탭 또는 상품 탐색 페이지에서 가입을 진행한다.  
13. 상품 카드에서 기간, 이율 등을 확인 후 '가입하기' 클릭  
14. 시스템은 선택한 상품 정보를 `PortfolioEntry`에 기록하고, 금액만큼 자산 차감  
15. 수익 계산은 만기 또는 이율 기준으로 자동 반영됨  

#### 5. 거래 내역 및 수익률 확인

16. 사용자는 '포트폴리오' 또는 '거래 내역' 메뉴에서 다음을 확인한다:
   - 주식/금융상품 포함 전체 투자 내역
   - 자산별 수익률, 총 수익률, 잔고
   - 시계열 수익률 그래프 및 투자 비중 차트

---

### 조건 분기 정리

| 조건 | 처리 방식 |
|------|------------|
| 자산 부족 | 매수/가입 불가 + 경고 표시 |
| 매도 수량 초과 | 매도 불가 + 경고 표시 |
| 동일 종목 추가 매수 | 평균 단가 갱신 후 보유 수량 증가 |
| 동일 금융상품 재가입 | 개별 내역으로 분리 저장 |
| 실시간 가격 반영 | 주식은 거래 시점 기준 시장가 적용 |
| 신규 유저 | 자동으로 초기 자산 1천만 원 설정 |

---

### UX 흐름 요약

**[포트폴리오 홈]**  
→ [주식 매수] → 종목 선택 → 수량 입력 → 매수 실행  
→ 자산 차감 + 보유 종목 갱신

**[금융상품 가입]**  
→ 상품 선택 → 금액/기간 설정 → 가입 실행  
→ 자산 차감 + 가입 내역 저장

**[포트폴리오]**  
→ 자산 목록, 수익률, 거래 이력 확인  
→ 시계열 그래프 및 투자 비중 시각화
